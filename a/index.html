<html>

<body>
  <h1>site 1</h1>
  <br />
  <span id="token"></span>
  <iframe id='commonSite' src='https://rotatecookies.onrender.com/c/commonSite.html' style='display: none;'></iframe>

  <script>
    function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
        }
        if (c.indexOf(name) == 0) {
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    (function () {
      const frame = document.querySelector('#commonSite');
      const commonSite = frame.contentWindow;
      const commonOrigin = 'https://rotatecookies.onrender.com';
      const tokenSpan = document.querySelector("#token");


      const cookie = getCookie("myToken");

      if (cookie) {
        tokenSpan.innerText = cookie;
        return;
      }


      window.addEventListener(
        "message",
        (event) => {
          if (event?.data?.type != 'token') return;

          if (event.data.invalid) {
            if (confirm('Invalid token. Go to the login page?'))
              return window.location.href = 'http://localhost:9092?url=' + window.location.href
          }

          tokenSpan.innerText = event.data.token;
        },
        false,
      );


      frame.onload = () => {
        commonSite.postMessage({
          action: 'get'
        }, commonOrigin);
      }
    })();
  </script>
</body>

</html>

<!-- \"npx http-server ./a --port 9091\" -->